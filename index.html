<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora Percentual Progressiva</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #fff;
  padding: 20px;
}

.container {
  max-width: 500px;
  margin: auto;
  background: #020617;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0,0,0,.5);
}

h1 {
  text-align: center;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
  border: none;
}

button {
  background: #22c55e;
  font-weight: bold;
  cursor: pointer;
}

.exportar {
  background: #3b82f6;
}

.resultados {
  margin-top: 15px;
  background: #020617;
  padding: 10px;
  border-radius: 8px;
  max-height: 220px;
  overflow-y: auto;
  font-size: 14px;
}

canvas {
  margin-top: 20px;
}
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#020617">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBOvbrC2qReZaNawk4MG17cKjOUlPk8u2g",
  authDomain: "calculadora-app-926cf.firebaseapp.com",
  projectId: "calculadora-app-926cf",
  storageBucket: "calculadora-app-926cf.firebasestorage.app",
  messagingSenderId: "439559158948",
  appId: "1:439559158948:web:145ab4b988115bc01b7a31"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.auth = auth;
window.db = db;
window.GoogleAuthProvider = GoogleAuthProvider;
window.signInWithPopup = signInWithPopup;
window.signInWithEmailAndPassword = signInWithEmailAndPassword;
window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
window.onAuthStateChanged = onAuthStateChanged;
window.signOut = signOut;
</script>
</head>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('PWA ativo'))
    .catch(err => console.log('Erro PWA', err));
}
</script>

<body>
<div id="login">
  <h2>Login</h2>

  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">

  <button onclick="loginEmail()">Entrar</button>
  <button onclick="registrar()">Criar conta</button>

  <hr>

  <button onclick="loginGoogle()">Entrar com Google</button>
</div>

<div id="app" style="display:none;">
  <h2>App</h2>
  <div class="container">
  <h1>Calculadora % Progressiva</h1>

  <input type="number" id="valorInicial" placeholder="Valor inicial (ex: 40)">
  <input type="number" id="porcentagem" placeholder="Porcentagem (%) (ex: 50)">
  <input type="number" id="quantidade" placeholder="Quantidade de contas">

  <button onclick="calcular()">Calcular</button>
  <button class="exportar" onclick="exportarPDF()">Exportar PDF</button>

  <div class="resultados" id="resultados"></div>

  <canvas id="grafico"></canvas>
</div>
  <button onclick="logout()">Sair</button>

  <!-- AQUI vão entrar as abas depois -->
</div>

<script>
let chart;
let historico = [];

function calcular() {
  const valorInicial = Number(document.getElementById("valorInicial").value);
  const porcentagem = Number(document.getElementById("porcentagem").value);
  const quantidade = Number(document.getElementById("quantidade").value);
  const resultadosDiv = document.getElementById("resultados");

  let valorAtual = valorInicial;
  historico = [];
  resultadosDiv.innerHTML = "";

  for (let i = 1; i <= quantidade; i++) {
    let ganho = valorAtual * (porcentagem / 100);
    let novoValor = valorAtual + ganho;

    historico.push(
      `${i}) ${valorAtual.toFixed(2)}%${porcentagem} = ${ganho.toFixed(2)} | ${ganho.toFixed(2)} + ${valorAtual.toFixed(2)} = ${novoValor.toFixed(2)}`
    );

    resultadosDiv.innerHTML += `
      <p>
        ${i}) ${valorAtual.toFixed(2)}%${porcentagem} = ${ganho.toFixed(2)}<br>
        ${ganho.toFixed(2)} + ${valorAtual.toFixed(2)} = <b>${novoValor.toFixed(2)}</b>
      </p>
    `;

    valorAtual = novoValor;
  }

  const totalFinal = valorAtual;
  const lucro = totalFinal - valorInicial;

  criarGrafico(valorInicial, lucro);
}

function criarGrafico(investido, lucro) {
  const ctx = document.getElementById('grafico');

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Investido', 'Lucro'],
      datasets: [{
        data: [investido, lucro],
      }]
    }
  });
}

function exportarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const valorInicial = document.getElementById("valorInicial").value;
  const porcentagem = document.getElementById("porcentagem").value;
  const quantidade = document.getElementById("quantidade").value;

  let y = 10;

  doc.setFontSize(14);
  doc.text("Relatório - Calculadora Percentual Progressiva", 10, y);
  y += 10;

  doc.setFontSize(11);
  doc.text(`Valor inicial: ${valorInicial}`, 10, y); y += 6;
  doc.text(`Porcentagem: ${porcentagem}%`, 10, y); y += 6;
  doc.text(`Quantidade de contas: ${quantidade}`, 10, y); y += 10;

  doc.text("Detalhes dos cálculos:", 10, y);
  y += 8;

  historico.forEach(linha => {
    if (y > 280) {
      doc.addPage();
      y = 10;
    }
    doc.text(linha, 10, y);
    y += 6;
  });

  doc.save("resultado-calculo.pdf");
}
</script>
<script>
function loginGoogle() {
  const provider = new GoogleAuthProvider();
  signInWithPopup(auth, provider);
}

function loginEmail() {
  signInWithEmailAndPassword(auth, email.value, senha.value)
    .catch(err => alert(err.message));
}

function registrar() {
  createUserWithEmailAndPassword(auth, email.value, senha.value)
    .catch(err => alert(err.message));
}

function logout() {
  signOut(auth);
}

onAuthStateChanged(auth, user => {
  if (user) {
    login.style.display = "none";
    app.style.display = "block";
  } else {
    login.style.display = "block";
    app.style.display = "none";
  }
});
</script>
<script type="module" src="script.js"></script>
</body>
</html>

</body>
</html>
