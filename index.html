<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Percentual Progressiva</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b0f14;
  --card:#161b22;
  --input:#1e252e;
  --primary:#2563eb;
  --danger:#dc2626;
  --text:#ffffff;
}
body{
  margin:0;
  font-family:system-ui, Arial;
  background:var(--bg);
  color:var(--text);
}
.tabs{
  display:flex;
  background:#020617;
}
.tab{
  flex:1;
  padding:12px;
  text-align:center;
  cursor:pointer;
  font-weight:600;
  color:#94a3b8;
}
.tab.active{
  color:#fff;
  border-bottom:3px solid var(--primary);
}
.container{
  max-width:520px;
  margin:auto;
  padding:16px;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:12px;
  margin-top:14px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
  font-size:15px;
}
input{background:var(--input);color:#fff;}
button{background:var(--primary);color:#fff;font-weight:600;}
.operacao{
  background:var(--input);
  padding:12px;
  border-radius:10px;
  margin-top:10px;
}
.operacao small{color:#cbd5f5;}
.actions{
  display:flex;
  gap:6px;
  margin-top:8px;
}
.actions .del{background:var(--danger);}
.stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.stat{
  background:var(--input);
  padding:10px;
  border-radius:8px;
  text-align:center;
}
.hidden{display:none;}
canvas{margin-top:15px;}
.resultado{
  margin-top:10px;
  font-weight:600;
  text-align:center;
}
</style>
</head>

<body>

<div class="tabs">
  <div class="tab active" onclick="abrirTab(event,'calc')">ðŸ§® Calculadora</div>
  <div class="tab" onclick="abrirTab(event,'ops')">ðŸ“‹ OperaÃ§Ãµes</div>
  <div class="tab" onclick="abrirTab(event,'resumo')">ðŸ“Š Resumo</div>
</div>

<div class="container">

<!-- CALCULADORA -->
<div id="calc" class="tabContent">
  <div class="card">
    <input id="valor" type="number" placeholder="Valor base (ex: 50)">
    <input id="percentual" type="number" placeholder="Percentual (%) ex: 40">
    <input id="quantidade" type="number" placeholder="Quantidade de contas">
    <button onclick="executar()">Executar</button>
    <div id="preview" class="resultado"></div>
  </div>
</div>

<!-- OPERAÃ‡Ã•ES -->
<div id="ops" class="tabContent hidden">
  <div class="card">
    <h3>OperaÃ§Ãµes</h3>
    <div id="lista"></div>
  </div>
</div>

<!-- RESUMO -->
<div id="resumo" class="tabContent hidden">
  <div class="card">
    <div class="stats">
      <div class="stat"><strong>Hoje</strong><div id="hoje">0</div></div>
      <div class="stat"><strong>Semana</strong><div id="semana">0</div></div>
      <div class="stat"><strong>MÃªs</strong><div id="mes">0</div></div>
      <div class="stat"><strong>ConcluÃ­das</strong><div id="qtd">0</div></div>
    </div>
    <canvas id="grafico"></canvas>
  </div>
</div>

</div>

<script>
let operacoes = JSON.parse(localStorage.getItem("operacoes")) || [];
let grafico;

function abrirTab(e,id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  e.target.classList.add("active");
  document.querySelectorAll(".tabContent").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function salvar(){
  localStorage.setItem("operacoes",JSON.stringify(operacoes));
}

function executar(){
  let v = +valor.value;
  let p = +percentual.value;
  let q = +quantidade.value;
  if(!v||!p||!q) return alert("Preencha tudo");

  let texto = "";
  for(let i=0;i<q;i++){
    let ganho = v*p/100;
    let total = v+ganho;
    texto += `${p}% de ${v} = ${ganho.toFixed(2)} â†’ Total: ${total.toFixed(2)}<br>`;
    operacoes.push({
      base:v, perc:p, ganho, total,
      data:new Date().toISOString(),
      ok:false
    });
    v = total;
  }
  preview.innerHTML = texto;
  salvar();
  renderizar();
}

function renderizar(){
  lista.innerHTML="";
  let h=0,s=0,m=0,c=0;
  let agora=new Date();

  operacoes.forEach((op,i)=>{
    let d=new Date(op.data);
    if(op.ok){
      c++; h+=op.ganho;
      if((agora-d)/86400000<=7) s+=op.ganho;
      if(agora.getMonth()==d.getMonth()) m+=op.ganho;
    }

    let div=document.createElement("div");
    div.className="operacao";
    div.innerHTML=`
      <strong>${op.perc}% de ${op.base} = ${op.ganho.toFixed(2)}</strong>
      <small>Total: ${op.total.toFixed(2)}</small><br>
      <label><input type="checkbox" ${op.ok?"checked":""} onchange="toggle(${i})"> ConcluÃ­da</label>
      <div class="actions">
        <button onclick="editar(${i})">Editar</button>
        <button class="del" onclick="excluir(${i})">Excluir</button>
      </div>
    `;
    lista.appendChild(div);
  });

  hoje.innerText=h.toFixed(2);
  semana.innerText=s.toFixed(2);
  mes.innerText=m.toFixed(2);
  qtd.innerText=c;

  atualizarGrafico(h,s,m,c);
}

function toggle(i){ operacoes[i].ok=!operacoes[i].ok; salvar(); renderizar(); }
function excluir(i){ if(confirm("Excluir?")){ operacoes.splice(i,1); salvar(); renderizar(); } }
function editar(i){
  let novo=prompt("Novo percentual:",operacoes[i].perc);
  if(!novo) return;
  operacoes[i].perc=+novo;
  operacoes[i].ganho=operacoes[i].base*novo/100;
  operacoes[i].total=operacoes[i].base+operacoes[i].ganho;
  salvar(); renderizar();
}

function atualizarGrafico(h,s,m,c){
  if(grafico) grafico.destroy();
  grafico=new Chart(document.getElementById("grafico"),{
    type:"pie",
    data:{
      labels:["Hoje","Semana","MÃªs","ConcluÃ­das"],
      datasets:[{data:[h,s,m,c]}]
    }
  });
}

renderizar();
</script>

</body>
</html>
